<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semiconductor Yield Intelligence - AI + ML Platform</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="header">
        <div class="logo">
            <div class="logo-icon">ðŸª©ðŸ§ </div>
            <span>WaferIQ</span>
        </div>
        <div class="ai-badge">
            <div class="pulse"></div>
            <span>Local LLM + ML Powered (LLaMA 3 + TensorFlow.js)
</span>
        </div>
    </div>

    <div class="container">
        <aside class="sidebar">
            <div class="section-title">
                Fab Setup
                <span class="tooltip-icon" data-tooltip="Configure production line and wafer specifications">?</span>
            </div>

            <div class="control-group">
                <label for="productionLine">
                    Production Line
                    <span class="tooltip-icon" data-tooltip="N3=3nm, N5=5nm, N7=7nm, N10=10nm. Smaller numbers mean more advanced transistor density and tighter process tolerances.">?</span>
                </label>
                <select id="productionLine">
                    <option value="N3">N3 Node (3nm)</option>
                    <option value="N5">N5 Node (5nm)</option>
                    <option value="N7">N7 Node (7nm)</option>
                    <option value="N10">N10 Node (10nm)</option>
                </select>
            </div>

            <div class="control-group">
                <label for="waferDiameter">Wafer Diameter</label>
                <select id="waferDiameter">
                    <option value="200">200mm (8 inch)</option>
                    <option value="300" selected>300mm (12 inch)</option>
                    <option value="450">450mm (18 inch)</option>
                </select>
            </div>

            <div class="control-group">
                <label for="dieSize">Die Size (mmÂ²)</label>
                <input type="number" id="dieSize" value="100" min="10" max="1000">
                <div class="slider-container">
                    <input type="range" id="dieSizeSlider" min="10" max="1000" value="100">
                    <span class="slider-value" id="dieSizeValue">100 mmÂ²</span>
                </div>
            </div>

            <button class="btn-primary" id="startRun">
                <span>ðŸš€</span>
                <span>START PRODUCTION RUN</span>
            </button>

        </aside>

        <main class="main-content">
            <div class="card">
                <h2 class="card-title">
                    Wafer Map
                    <button class="info-button" id="defectInfoBtn">ðŸ“˜ Defect Types</button>
                    <button class="info-button" id="exportDatabaseBtn">ðŸ’¾ Export DB</button>
                    <button class="info-button" id="databaseStatsBtn">ðŸ“Š DB Stats</button>
                </h2>
                <div class="wafer-container">
                    <canvas id="waferCanvas" width="600" height="600"></canvas>
                </div>

                <!-- Defect Color Legend -->
                <div class="color-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #00ff88;"></div>
                        <span>Premium (Perfect)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #66d9a6;"></div>
                        <span>Standard (Good)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffaa00;"></div>
                        <span>Economy (Marginal)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff4444;"></div>
                        <span>Faulty (Defective)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #aa0000;"></div>
                        <span>Dead (Failed)</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">Production Financials</h2>

                <div class="diagnosis-section">
                    <div class="diagnosis-header">
                        <h3 class="diagnosis-title">AI Diagnosis</h3>
                        <span class="diagnosis-badge" id="diagnosisBadge" style="background: rgba(139,146,168,0.2); color: var(--text-secondary);">
                            Awaiting Production Run
                        </span>
                    </div>
                    
                    <div class="confidence-meter">
                        <div class="confidence-label">
                            <span>AI Confidence</span>
                            <span id="confidenceValue">--</span>
                        </div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" id="confidenceFill" style="width: 0%"></div>
                        </div>
                    </div>

                    <div id="rootCauseContainer">
                        <strong style="font-size: 0.875rem; color: var(--text-secondary);">ROOT CAUSE ANALYSIS:</strong>
                        <ul class="root-cause-list" id="rootCauseList">
                            <li class="root-cause-item">Run a production cycle to generate AI analysis.</li>
                        </ul>
                    </div>
                </div>

                <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--text-secondary);">
                    Revenue Breakdown
                </h3>

                <table class="revenue-table">
                    <thead>
                        <tr>
                            <th>Tier</th>
                            <th style="text-align: right;">Count</th>
                            <th style="text-align: right;">Price/Unit</th>
                            <th style="text-align: right;">Subtotal</th>
                        </tr>
                    </thead>
                    <tbody id="revenueTableBody">
                        <tr>
                            <td colspan="4" style="text-align: center; color: var(--text-secondary);">
                                Execute production run to calculate financial output
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="financial-grid">
                    <div class="metric-card">
                        <div class="metric-label">Gross Revenue</div>
                        <div class="metric-value" id="grossRevenue">$0</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Total Costs</div>
                        <div class="metric-value negative" id="totalCosts">$0</div>
                        <div class="cost-breakdown-popup" id="costBreakdownPopup"></div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Net Profit</div>
                        <div class="metric-value positive" id="netProfit">$0</div>
                        <div class="cost-breakdown-popup" id="profitBreakdownPopup"></div>
                    </div>
                </div>
            </div>

            <div class="card full-width" id="aiAnalysisCard" style="display: none;">
                <h2 class="card-title">Manufacturing Intelligence Report
</h2>
                <div id="detailedAnalysis"></div>
            </div>
        </main>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <div style="font-size: 1.125rem; margin-bottom: 0.5rem;" id="loadingText">
                Processing...
            </div>
            <div style="font-size: 0.875rem; color: var(--text-secondary);" id="loadingSubtext">
                Initializing AI systems
            </div>
        </div>
    </div>

    <!-- Defect Information Modal -->
    <div class="defect-info-modal" id="defectInfoModal">
        <div class="defect-info-content">
            <div class="defect-info-header">
                <h2>ðŸ“˜ Defect Type Reference</h2>
                <button class="close-btn" id="closeDefectInfo">âœ•</button>
            </div>
            <div class="defect-info-body">
                <div class="defect-category">
                    <h3>ðŸ”´ Common Manufacturing Defects</h3>
                    <div class="defect-item">
                        <strong>Edge Die Failure:</strong> Dies at wafer edges fail due to stress, thermal gradients, or handling damage during processing.
                    </div>
                    <div class="defect-item">
                        <strong>Center Particle Contamination:</strong> Particles deposited in center region during spin coating or deposition processes.
                    </div>
                    <div class="defect-item">
                        <strong>Radial Pattern Defect:</strong> Spoke-like defect pattern caused by tool rotation asymmetry or gas flow irregularities.
                    </div>
                    <div class="defect-item">
                        <strong>Random Defect Scatter:</strong> Randomly distributed particles, contamination, or micro-defects across the wafer.
                    </div>
                    <div class="defect-item">
                        <strong>Cluster Failure:</strong> Localized defect cluster from equipment malfunction or contamination event.
                    </div>
                    <div class="defect-item">
                        <strong>Scratch Pattern:</strong> Physical damage from wafer handling, robotics, or cassette contact.
                    </div>
                </div>

                <div class="defect-category">
                    <h3>âš¡ Process-Specific Defects</h3>
                    <div class="defect-item">
                        <strong>Wafer Bow Distortion:</strong> Wafer warping from thermal stress or film stress mismatch, affects edge dies.
                    </div>
                    <div class="defect-item">
                        <strong>Etch Non-Uniformity:</strong> Uneven etching across wafer due to gas flow, plasma distribution, or chemistry variation.
                    </div>
                    <div class="defect-item">
                        <strong>Ion Implantation Drift:</strong> Beam drift or dose non-uniformity during ion implantation process.
                    </div>
                    <div class="defect-item">
                        <strong>Lithography Misalignment:</strong> Pattern misalignment from stepper/scanner focus, leveling, or overlay errors.
                    </div>
                    <div class="defect-item">
                        <strong>Chemical Vapor Deposition Defect:</strong> Non-uniform film deposition from temperature, pressure, or gas flow variations.
                    </div>
                    <div class="defect-item">
                        <strong>Metal Layer Delamination:</strong> Metal film peeling due to poor adhesion, stress, or thermal cycling.
                    </div>
                    <div class="defect-item">
                        <strong>Plasma Damage:</strong> Electrical damage from plasma charging during dry etch or deposition processes.
                    </div>
                    <div class="defect-item">
                        <strong>Photoresist Residue:</strong> Incomplete photoresist stripping leaving contamination patterns.
                    </div>
                </div>

                <div class="defect-category">
                    <h3>ðŸ’¥ Critical Failure Modes</h3>
                    <div class="defect-item">
                        <strong>Micro-crack Propagation:</strong> Hairline fractures spreading from stress concentration points.
                    </div>
                    <div class="defect-item">
                        <strong>Thermal Stress Fracture:</strong> CATASTROPHIC - Severe thermal shock causing widespread wafer cracking.
                    </div>
                    <div class="defect-item">
                        <strong>Cross-Contamination:</strong> Contamination transfer between process tools or wafer lots.
                    </div>
                    <div class="defect-item">
                        <strong>Incomplete Oxide Formation:</strong> Patchy oxide growth from temperature non-uniformity or contaminated surfaces.
                    </div>
                    <div class="defect-item">
                        <strong>Step Coverage Failure:</strong> Poor film coverage over topography features, common at edges and vias.
                    </div>
                    <div class="defect-item">
                        <strong>Polysilicon Grain Boundaries:</strong> Crystal defects in polysilicon layers affecting electrical properties.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Database Stats Modal -->
    <div class="db-stats-modal" id="dbStatsModal">
        <div class="db-stats-content">
            <div class="db-stats-header">
                <h2>Database Intelligence</h2>
                <button class="close-btn" id="closeDbStats">âœ•</button>
            </div>
            <div class="db-stats-body" id="dbStatsBody">
            </div>
        </div>
    </div>

    <!-- Export Confirmation Modal -->
    <div class="db-stats-modal" id="exportModal">
        <div class="db-stats-content" style="max-width: 500px;">
            <div class="db-stats-header">
                <h2>Database Exported</h2>
                <button class="close-btn" id="closeExportModal">âœ•</button>
            </div>
            <div class="db-stats-body" id="exportModalBody">
            </div>
        </div>
    </div>

    <!-- JS Modules -->
    <script src="js/config.js"></script>
    <script src="js/training-data.js"></script>
    <script src="js/wafer-database.js"></script>
    <script src="js/wafer.js"></script>
    <script src="js/financials.js"></script>
    <script src="js/ml-pattern-recognition.js"></script>
    <script src="js/ai-defect-generator.js"></script>
    <script src="js/ai-defect-analyzer.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
